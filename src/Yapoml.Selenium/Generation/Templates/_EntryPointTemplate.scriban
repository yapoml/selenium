// auto-generated by {{version}}

using OpenQA.Selenium;

namespace Yapoml.Selenium
{
	public partial class YaSpace
	{
		private IWebDriver _webDriver;

		private Yapoml.Framework.Options.ISpaceOptions _spaceOptions;

		public YaSpace(IWebDriver webDriver, Yapoml.Framework.Options.ISpaceOptions spaceOptions)
		{
			_webDriver = webDriver;
			_spaceOptions = spaceOptions;
		}

{{ for space in spaces }}
		public {{space.namespace}}.{{space.name}}Space {{space.name}}
		{
			get
			{
				return _spaceOptions.Get<Yapoml.Selenium.Factory.ISpaceFactory>().Create<{{space.namespace}}.{{space.name}}Space>(_webDriver, _spaceOptions);
			}
		}
{{ end }}
{{ for page in pages }}
		/// <summary>
		/// Consists of the following page components:
		/// <list type="bullet">
		{{ for c in page.components -}}
		/// <item>
		///   <description>{{ if c.is_plural }}List of {{ end }}{{ c.name }}</description>
		/// </item>
		{{ end -}}
		/// </list>
		/// </summary>
		public {{page.namespace}}.{{page.name}} {{page.name}}
		{
			get
			{
				return _spaceOptions.Get<Yapoml.Selenium.Factory.IPageFactory>().Create<{{page.namespace}}.{{page.name}}>(_webDriver, _spaceOptions);
			}
		}
{{ end }}
	}

	public static class YapomlExtensions
	{
		public static YaSpace Ya(this IWebDriver webDriver)
		{
			return webDriver.Ya((options) => { });
		}

		public static YaSpace Ya(this IWebDriver webDriver, System.Action<Yapoml.Framework.Options.ISpaceOptions> spaceOptionsCallback)
		{
			var spaceOptions = new Yapoml.Framework.Options.SpaceOptions();

			// default logger
			spaceOptions.Register<Yapoml.Framework.Logging.ILogger>(new Yapoml.Framework.Logging.ConsoleLogger());

			// default factories
			spaceOptions.Register<Yapoml.Selenium.Factory.ISpaceFactory>(new Yapoml.Selenium.Factory.DefaultSpaceFactory());
			spaceOptions.Register<Yapoml.Selenium.Factory.IPageFactory>(new Yapoml.Selenium.Factory.DefaultPageFactory());
			spaceOptions.Register<Yapoml.Selenium.Factory.IComponentFactory>(new Yapoml.Selenium.Factory.DefaultComponentFactory());

			var eventSource = new Yapoml.Selenium.Events.EventSource();
			spaceOptions.Register<Yapoml.Selenium.Events.IEventSource>(eventSource);

			var logProducer = new Yapoml.Selenium.Events.LogEventsProducer(spaceOptions);
			logProducer.Init();

			spaceOptionsCallback?.Invoke(spaceOptions);

			return new YaSpace(webDriver, spaceOptions);
		}
	}
}